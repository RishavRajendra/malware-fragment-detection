# Malware Fragment Detection from File Blocks using Ensemble Techniques in MachineLearning
Release Date: 02/01/2019

We wrote a manuscript that detailed our approach. You can read it [here](https://rishavrajendra.github.io/Malware_Fragment_Detection.pdf). 

## Getting Started

These instructions will get you a copy of the project up and running on your local machine for development and testing purposes. See deployment for notes on how to deploy the project on a live system.

### Prerequisites

Tested on Python 3.7.2

What things you need to install the software and how to install them

```
pip install scipy
pip install mlxtend
pip install scikit-learn
pip install xgboost
pip install numpy
pip install pandas
```

### Collecting Data

Malware data was taken from a public available database called [VirusShare](https://rishavrajendra.github.io). Non-malware data was obtained by running the following command fresh installs of Windows 8.1 operating system on a virtual environment:
```
find / -type f -exec cp {} data/ \;
```

The files were then divided into fragments of 4096 bytes each to replicate a block size. The first 4096 bytes were ignored to remove the header of the file.

After all the files are divided, we randomly chose fragments from available dataset and extracted the features mentioned in the manuscript from it.

### Stacking Structure

![alt text](https://github.com/RishavRajendra/malware-fragment-detection/blob/master/Pictures/StackingCVClassifier.png)

## Running the tests

0. Break the files into 4096 bytes:
```
python parser.py -i input_dir -o output_dir -l number_of_files
```

1. Extract features from the dataset:
```
python featurise.py -i input_dir -o output_dir -l label_for_created_svm -n number_of_fragments
```

2. Train and get results:
```
python malwareIdentifier.py
```

## Evaluation Results

We conducted two tests. The first was with a 28,000 fragment dataset divided equally with malware and non-malware fragments. We achieved an accuracy of 91.62%. For the second test, we used a much larger 1,20,000 fragment dataset which also had equal representation of malware and non-malware fragments.

![alt text](https://github.com/RishavRajendra/malware-fragment-detection/blob/master/Pictures/Features.png)
![alt text](https://github.com/RishavRajendra/malware-fragment-detection/blob/master/Pictures/cr_14000.png)
![alt text](https://github.com/RishavRajendra/malware-fragment-detection/blob/master/Pictures/cr_60000.png)
![alt text](https://github.com/RishavRajendra/malware-fragment-detection/blob/master/Pictures/14000.png)
![alt text](https://github.com/RishavRajendra/malware-fragment-detection/blob/master/Pictures/60000.png)

## Authors

* **Rishav Rajendra** - [Website](https://rishavrajendra.github.io)
* **Manish Bhatt** - [Linkedin](https://www.linkedin.com/in/manishbhatt132123/)

## License

This project is licensed under the MIT License - see the [LICENSE.md](LICENSE.md) file for details
